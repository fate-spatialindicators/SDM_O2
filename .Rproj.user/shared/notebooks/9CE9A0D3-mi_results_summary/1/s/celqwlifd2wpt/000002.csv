"0","# first load models"
"0","m_po2 <- readRDS(""output/wc/model_13_MI.rds"")"
"0","m_o2 <- readRDS(""output/wc/model_11_MI.rds"")"
"0","m_null <- readRDS(""output/wc/model_2_MI.rds"")"
"0","dat <- load_data()"
"0","# rescale variables"
"0","dat$depth = scale(log(dat$depth))"
"0","dat$temp = scale(dat$temp)"
"0","dat$depth = scale(log(dat$depth))"
"2","NaNs produced"
"0","dat$temp = scale(dat$temp)"
"0","mean.po2 <- mean(dat$po2)"
"0","std.po2 <- sd(dat$po2)"
"0","mean.do <- mean(dat$o2)"
"0","std.do <- sd(dat$o2)"
"0","mean.mi <- mean(dat$mi)"
"0","std.mi <- sd(dat$mi)"
"0","dat$mi = scale(dat$mi)"
"0","dat$o2 = scale(dat$o2)"
"0","dat$po2 <- scale(dat$po2)"
"0","predict_po2 <- predict(m_po2)"
"0","predict_o2 <- predict(m_o2)"
"0","predict_null <- predict(m_null)"
"0","fixed_effects_po2 <- m_po2$model$par"
"0","bp_ind <- grep(""b_threshold"", names(fixed_effects_po2))"
"0","bp_po2 <- fixed_effects_po2[bp_ind[2]]"
"0","slope_po2 <- fixed_effects_po2[bp_ind[1]]"
"0","# create new column in data that contains breakpoint if po2 is above breakpoint, and lists the actual po2 otherwise"
"0","zeros <- rep(bp_po2, times = nrow(dat))"
"0","dat$po2_bp <- zeros"
"0","dat$po2_bp[dat$po2<=bp_po2] = back.convert(dat$po2[dat$po2<=bp_po2], mean.po2, std.po2)"
"0","# plot the po2 only below the threshold"
"0","ggplot(dat, aes(longitude, latitude, col = po2_bp)) + scale_colour_gradient2() +"
"0","  geom_point(alpha=0.6, size = 0.5) + facet_wrap(~year) + labs(col = ""p02 below breakpoint"")"
